# 一、并发简史

在早期的计算机中不包含操作系统，它们从头到尾只执行一个程序，并且这个程序能访问计算机中的所有资源。

操作系统的出现使得计算机每次能运行多个程序，并且不同的程序都在单独的进程中运行：操作系统为各个独立执行的进程分配各种资源，包括内存、文件句柄以及安全证书等。

加入操作系统来实现多个程序同时执行的原因（进程出现的原因）：

- 资源利用率
- 公平性
- 便利性

这些原因同样也促使着线程的出现。线程允许在同一个进程中同时存在多个程序控制流。线程会共享进程范围内的资源，例如内存句柄和文件句柄，但每个线程都有各自的程序计数器、栈以及局部变量等。

线程也被称为轻量级进程，在大多数现代操作系统中，线程是操作系统调度的基本单位。

# 二、线程的优势

## 1.发挥多处理器的强大能力

由于操作系统的基本调度单位是线程，因此如果在程序中只有一个线程，那么最多同时只能在一个处理器上运行。多线程程序可以同时在多个处理器上执行，如果设计正确，多线程程序可以通过提高处理器资源利用率来提升系统吞吐率。

使用多个线程也有助于在单处理器系统上获得更高的吞吐率。

## 2.建模的简单性

通过使用线程，可以将复杂并且异步的工作流进一步分解为一组简单并且同步的工作流，每个工作流在一个单独的线程中执行，并在特定的同步位置进行交互。

## 3.异步事件的简化处理

使用多线程可以异步的处理事件。

早期的操作系统通常会将进程中可创建的线程数量限制在一个较低的阈值内。然后现代的操作系统中可创建线程的数量已经得到极大的提升。

## 4.响应更灵敏的用户界面

将长时间运行的任务放在一个单独的线程中运行，事件线程就能及时地处理界面事件，从而使用户界面具有更高的灵敏度。

# 三、线程带来的风险

## 1.安全性问题

由于多个线程要共享相同的内存地址空间，并且是并发运行，因此它们可能会访问或修改其他线程正在使用的变量。当多个线程同时访问和修改相同的变量时，将会在串行编程模型中引入非串行因素，例如多个线程进行 i++ 操作。

## 2.活跃性问题

当某个操作无法继续执行下去时，就会发生活跃性问题，例如：死锁、饥饿、活锁。

## 3.性能问题

性能问题包含多个方面，例如服务时间过长，响应不灵敏，吞吐率过低，资源消耗过高，或者可伸缩性较低等。

在多线程程序中，当线程调度器临时挂起活跃线程并转而运行另一个线程时，就会频繁得出现上下文切换操作（Context Switch），这种操作会带来极大的开销：保存和恢复执行上下文，丢失局部性，并且 CPU 时间将更多地花在线程调度而不是线程运行上。当线程共享数据时，必须使用同步机制，而这些机制往往会抑制某些编译器优化，使内存缓冲区的数据无效，以及增加共享内存总线的同步流量。

# 四、线程无处不在

每个 Java 应用程序都会使用线程。当 JVM 启动时，会为 JVM 的内部任务（例如：垃圾收集、终结操作等）创建后台线程，并创建一个主线程来运行 main 方法。

框架通过在框架线程中调用应用程序代码将并发性引入到程序中，在代码中将不可避免地访问应用程序状态，因此所有访问这些状态地代码路径都必须是线程安全的。